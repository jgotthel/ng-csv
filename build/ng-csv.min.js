/*! ng-csv 28-02-2019 */
!function(e,a){angular.module("ngCsv.config",[]).value("ngCsv.config",{debug:!0}).config(["$compileProvider",function(e){angular.isDefined(e.urlSanitizationWhitelist)?e.urlSanitizationWhitelist(/^\s*(https?|ftp|mailto|file|data):/):e.aHrefSanitizationWhitelist(/^\s*(https?|ftp|mailto|file|data):/)}]),angular.module("ngCsv.directives",["ngCsv.services"]),angular.module("ngCsv.services",[]),angular.module("ngCsv",["ngCsv.config","ngCsv.services","ngCsv.directives","ngSanitize"]),"undefined"!=typeof module&&"undefined"!=typeof exports&&module.exports===exports&&(module.exports="ngCsv"),angular.module("ngCsv.services").service("CSV",["$q",function(e){var a="\r\n",i={"\\t":"\t","\\b":"\b","\\v":"\v","\\f":"\f","\\r":"\r"};this.stringifyField=function(e,a){return"locale"===a.decimalSep&&this.isFloat(e)?e.toLocaleString():"."!==a.decimalSep&&this.isFloat(e)?e.toString().replace(".",a.decimalSep):"string"==typeof e?(e=e.replace(/"/g,'""'),(a.quoteStrings||e.indexOf(",")>-1||e.indexOf("\n")>-1||e.indexOf("\r")>-1)&&(e=a.txtDelim+e+a.txtDelim),e):"boolean"==typeof e?e?"TRUE":"FALSE":e},this.isFloat=function(e){return+e===e&&(!isFinite(e)||Boolean(e%1))},this.stringify=function(i,n){var t=e.defer(),r=this,l="",o="",d=e.when(i).then(function(e){var i,d;angular.isDefined(n.header)&&n.header&&(i=[],angular.forEach(n.header,function(e,a){this.push(r.stringifyField(e,n))},i),d=i.join(n.fieldSep?n.fieldSep:","),o+=d+a);var s=[];if(angular.isArray(e)?s=e:angular.isFunction(e)&&(s=e()),angular.isDefined(n.label)&&n.label&&"boolean"==typeof n.label){var c,u;c=[];var f=n.columnOrder?n.columnOrder:s[0];angular.forEach(f,function(e,a){var i=n.columnOrder?e:a;this.push(r.stringifyField(i,n))},c),u=c.join(n.fieldSep?n.fieldSep:","),o+=u+a}angular.forEach(s,function(e,i){var t,l,d=angular.copy(s[i]);l=[];var c=n.columnOrder?n.columnOrder:d;angular.forEach(c,function(e,a){var i=n.columnOrder?d[e]:e;this.push(r.stringifyField(i,n))},l),t=l.join(n.fieldSep?n.fieldSep:","),o+=i<s.length?t+a:t}),n.addByteOrderMarker&&(l+="\ufeff"),l+=o,t.resolve(l)});return"function"==typeof d.catch&&d.catch(function(e){t.reject(e)}),t.promise},this.isSpecialChar=function(e){return void 0!==i[e]},this.getSpecialChar=function(e){return i[e]}}]),angular.module("ngCsv.directives").directive("ngCsv",["$parse","$q","CSV","$document","$timeout",function(i,n,t,r,l){return{restrict:"AC",scope:{data:"&ngCsv",filename:"@filename",header:"&csvHeader",columnOrder:"&csvColumnOrder",txtDelim:"@textDelimiter",decimalSep:"@decimalSeparator",quoteStrings:"@quoteStrings",fieldSep:"@fieldSeparator",lazyLoad:"@lazyLoad",addByteOrderMarker:"@addBom",ngClick:"&",charset:"@charset",label:"&csvLabel"},controller:["$scope","$element","$attrs","$transclude",function(e,a,i,r){e.csv="",angular.isDefined(e.lazyLoad)&&"true"==e.lazyLoad||angular.isArray(e.data)&&e.$watch("data",function(a){e.buildCSV()},!0),e.getFilename=function(){return e.filename||"download.csv"},e.buildCSV=function(){var r,l=n.defer(),o=null;return a.addClass(i.ngCsvLoadingClass||"ng-csv-loading"),o=e.data(),angular.isFunction(o)&&(o=o()),t.stringify(o,(r={txtDelim:e.txtDelim?e.txtDelim:'"',decimalSep:e.decimalSep?e.decimalSep:".",quoteStrings:e.quoteStrings,addByteOrderMarker:e.addByteOrderMarker},angular.isDefined(i.csvHeader)&&(r.header=e.$eval(e.header)),angular.isDefined(i.csvColumnOrder)&&(r.columnOrder=e.$eval(e.columnOrder)),angular.isDefined(i.csvLabel)&&(r.label=e.$eval(e.label)),r.fieldSep=e.fieldSep?e.fieldSep:",",r.fieldSep=t.isSpecialChar(r.fieldSep)?t.getSpecialChar(r.fieldSep):r.fieldSep,r)).then(function(n){e.csv=n,a.removeClass(i.ngCsvLoadingClass||"ng-csv-loading"),l.resolve(n)}),e.$apply(),l.promise}}],link:function(i,n,t){n.bind("click",function(n){i.buildCSV().then(function(n){var t=new Blob([n],{type:"text/csv;charset=utf-8;"}),o=null;if(navigator.msSaveBlob)navigator.msSaveBlob(t,i.getFilename());else if(-1===navigator.userAgent.toLowerCase().indexOf("chrome")){var d=angular.element('<div data-tap-disabled="true"><a></a></div>'),s=angular.element(d.children()[0]);s.attr("href",e.URL.createObjectURL(t)),s.attr("download",i.getFilename()),-1===navigator.userAgent.toLowerCase().indexOf("safari")&&s.attr("target","_blank"),r.find("body").append(d),l(function(){s[0].click(),s.remove()},null)}else{o=e.URL.createObjectURL(t);var c=a.createElement("a");c.href=o,c.setAttribute("download",i.getFilename()),c.click()}}),i.$apply()})}}}])}(window,document);
